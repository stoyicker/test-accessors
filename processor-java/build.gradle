plugins {
    id 'java'
    id 'maven-publish'
}

dependencies {
    implementation project(':processors-base')
    implementation 'com.squareup:javapoet:1.11.1'
}

task sourcesJar(type: Jar) {
    group = JavaBasePlugin.DOCUMENTATION_GROUP
    description = 'Assembles a sources JAR'
    from sourceSets.main.allSource
}

publishing {
    publications {
        maven(MavenPublication) {
            artifactId 'test-accessors-processor-java'
            groupId 'com.github.stoyicker.test-accessors'
            version = {
                def stdout = new ByteArrayOutputStream()
                exec {
                    commandLine 'git', 'describe', '--tags'
                    standardOutput = stdout
                }
                return stdout.toString().trim()
            }()

            from components.java
        }
    }
}

artifacts {
    archives sourcesJar
}